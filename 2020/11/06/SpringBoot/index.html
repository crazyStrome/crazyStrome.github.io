<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Spring Boot笔记 | crazyStrome的博客</title><meta name="keywords" content="Java,笔记,Spring"><meta name="author" content="crazyStrome"><meta name="copyright" content="crazyStrome"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="description" content="2.  SpringBoot介绍2.2.  系统要求Spring Boot2.3.3需要Java 8以上，Spring框架5.2.7以上。 构建工具支持Maven3.3以上、Gradle 6.3以上。 2.2.1.  支持的servlet版本   Name Servlet Version    Tomcat 9.0 4.0   Jetty 9.4 3.1   Undertow 2.0 4.0">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring Boot笔记">
<meta property="og:url" content="http://crazystrome.github.io/2020/11/06/SpringBoot/index.html">
<meta property="og:site_name" content="crazyStrome的博客">
<meta property="og:description" content="2.  SpringBoot介绍2.2.  系统要求Spring Boot2.3.3需要Java 8以上，Spring框架5.2.7以上。 构建工具支持Maven3.3以上、Gradle 6.3以上。 2.2.1.  支持的servlet版本   Name Servlet Version    Tomcat 9.0 4.0   Jetty 9.4 3.1   Undertow 2.0 4.0">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://dzone.com/storage/temp/12434118-spring-boot-logo.png">
<meta property="article:published_time" content="2020-11-06T02:44:13.340Z">
<meta property="article:modified_time" content="2020-10-14T16:00:00.000Z">
<meta property="article:author" content="crazyStrome">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="笔记">
<meta property="article:tag" content="Spring">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://dzone.com/storage/temp/12434118-spring-boot-logo.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://crazystrome.github.io/2020/11/06/SpringBoot/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><script>var GLOBAL_CONFIG = { 
  root: '/',
  hexoversion: '5.2.0',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  ClickShowText: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: true,
  isSidebar: true,
  postUpdate: '2020-10-15 00:00:00'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(function () {
  window.activateDarkMode = function () {
    document.documentElement.setAttribute('data-theme', 'dark')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
    }
  }
  window.activateLightMode = function () {
    document.documentElement.setAttribute('data-theme', 'light')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
    }
  }

  const autoChangeMode = 'false'
  const t = saveToLocal.get('theme')
  if (autoChangeMode === '1') {
    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
    const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
    const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

    if (t === undefined) {
      if (isLightMode) activateLightMode()
      else if (isDarkMode) activateDarkMode()
      else if (isNotSpecified || hasNoSupport) {
        const now = new Date()
        const hour = now.getHours()
        const isNight = hour <= 6 || hour >= 18
        isNight ? activateDarkMode() : activateLightMode()
      }
      window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
        if (saveToLocal.get('theme') === undefined) {
          e.matches ? activateDarkMode() : activateLightMode()
        }
      })
    } else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else if (autoChangeMode === '2') {
    const now = new Date()
    const hour = now.getHours()
    const isNight = hour <= 6 || hour >= 18
    if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
    else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else {
    if (t === 'dark') activateDarkMode()
    else if (t === 'light') activateLightMode()
  }
})()</script><meta name="generator" content="Hexo 5.2.0"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="https://avatars2.githubusercontent.com/u/24493607?s=460&amp;u=ae13dfdaed519e38912080c57dd919504d032754&amp;v=4" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">48</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">24</div></a></div></div><div class="mobile_data_item is-center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">8</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div id="body-wrap"><div id="sidebar"><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#2-SpringBoot%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.</span> <span class="toc-text">2.  SpringBoot介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-%E7%B3%BB%E7%BB%9F%E8%A6%81%E6%B1%82"><span class="toc-number">1.1.</span> <span class="toc-text">2.2.  系统要求</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-2-1-%E6%94%AF%E6%8C%81%E7%9A%84servlet%E7%89%88%E6%9C%AC"><span class="toc-number">1.2.</span> <span class="toc-text">2.2.1.  支持的servlet版本</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-4-3-%E5%86%99%E4%BB%A3%E7%A0%81"><span class="toc-number">1.2.1.</span> <span class="toc-text">2.4.3.  写代码</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#3-%E4%BD%BF%E7%94%A8SpringBoot"><span class="toc-number">2.</span> <span class="toc-text">3.  使用SpringBoot</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3-2-%E6%9E%84%E5%BB%BA%E4%BB%A3%E7%A0%81"><span class="toc-number">2.1.</span> <span class="toc-text">3.2.  构建代码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-1-%E4%BD%BF%E7%94%A8default%E5%8C%85%E8%B7%AF%E5%BE%84"><span class="toc-number">2.1.1.</span> <span class="toc-text">3.2.1.  使用default包路径</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-2-2-%E5%AE%9A%E4%BD%8D%E4%B8%BB%E5%BA%94%E7%94%A8%E7%B1%BB"><span class="toc-number">2.1.2.</span> <span class="toc-text">3.2.2.  定位主应用类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-3-%E9%85%8D%E7%BD%AE%E7%B1%BB"><span class="toc-number">2.2.</span> <span class="toc-text">3.3.  配置类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-1-%E5%AF%BC%E5%85%A5%E5%85%B6%E4%BB%96%E9%85%8D%E7%BD%AE%E7%B1%BB"><span class="toc-number">2.2.1.</span> <span class="toc-text">3.3.1.  导入其他配置类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-3-2-%E5%AF%BC%E5%85%A5XML%E9%85%8D%E7%BD%AE%E6%95%B0%E6%8D%AE"><span class="toc-number">2.2.2.</span> <span class="toc-text">3.3.2.  导入XML配置数据</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-4-%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE"><span class="toc-number">2.3.</span> <span class="toc-text">3.4.  自动配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-1-%E6%9B%BF%E4%BB%A3%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%86%85%E5%AE%B9"><span class="toc-number">2.3.1.</span> <span class="toc-text">3.4.1.  替代自动配置内容</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-4-2-%E7%A6%81%E7%94%A8%E6%89%A7%E8%A1%8C%E7%9A%84%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E7%B1%BB"><span class="toc-number">2.3.2.</span> <span class="toc-text">3.4.2.  禁用执行的自动配置类</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-5-Spring-Beans%E5%92%8CDI%EF%BC%88%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5%EF%BC%89"><span class="toc-number">2.4.</span> <span class="toc-text">3.5.  Spring Beans和DI（依赖注入）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-6-%E4%BD%BF%E7%94%A8-SpringBootApplication%E6%B3%A8%E8%A7%A3"><span class="toc-number">2.5.</span> <span class="toc-text">3.6.  使用@SpringBootApplication注解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-8-%E5%BC%80%E5%8F%91%E8%80%85%E5%B7%A5%E5%85%B7"><span class="toc-number">2.6.</span> <span class="toc-text">3.8.  开发者工具</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#3-8-1-%E9%BB%98%E8%AE%A4%E5%B1%9E%E6%80%A7"><span class="toc-number">2.6.1.</span> <span class="toc-text">3.8.1.  默认属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-8-2-%E8%87%AA%E5%8A%A8%E9%87%8D%E5%90%AF"><span class="toc-number">2.6.2.</span> <span class="toc-text">3.8.2.  自动重启</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%AF%8F%E6%AC%A1%E9%87%8D%E5%90%AF%E8%AE%B0%E5%BD%95%E6%97%A5%E5%BF%97"><span class="toc-number">2.6.2.1.</span> <span class="toc-text">每次重启记录日志</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#exclude%E5%B1%9E%E6%80%A7"><span class="toc-number">2.6.2.2.</span> <span class="toc-text">exclude属性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%91%E5%90%AC%E9%A2%9D%E5%A4%96%E8%B7%AF%E5%BE%84"><span class="toc-number">2.6.2.3.</span> <span class="toc-text">监听额外路径</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%85%B3%E9%97%AD%E9%87%8D%E5%90%AF%E7%89%B9%E6%80%A7"><span class="toc-number">2.6.2.4.</span> <span class="toc-text">关闭重启特性</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8%E8%A7%A6%E5%8F%91%E6%96%87%E4%BB%B6"><span class="toc-number">2.6.2.5.</span> <span class="toc-text">使用触发文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E9%87%8D%E5%90%AF%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8"><span class="toc-number">2.6.2.6.</span> <span class="toc-text">自定义重启类加载器</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B1%80%E9%99%90%E6%80%A7"><span class="toc-number">2.6.2.7.</span> <span class="toc-text">局限性</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-8-3-%E5%AE%9E%E6%97%B6%E5%8A%A0%E8%BD%BD"><span class="toc-number">2.6.3.</span> <span class="toc-text">3.8.3.  实时加载</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-8-4-%E5%85%A8%E5%B1%80%E8%AE%BE%E7%BD%AE"><span class="toc-number">2.6.4.</span> <span class="toc-text">3.8.4.  全局设置</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E7%9B%91%E8%A7%86%E5%99%A8"><span class="toc-number">2.6.4.1.</span> <span class="toc-text">配置文件系统监视器</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-8-5-%E8%BF%9C%E7%A8%8B%E5%BA%94%E7%94%A8"><span class="toc-number">2.6.5.</span> <span class="toc-text">3.8.5.  远程应用</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#4-SpringBoot%E7%89%B9%E6%80%A7"><span class="toc-number">3.</span> <span class="toc-text">4.  SpringBoot特性</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#4-1-SpringApplication"><span class="toc-number">3.1.</span> <span class="toc-text">4.1.  SpringApplication</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-1-%E5%90%AF%E5%8A%A8%E5%A4%B1%E8%B4%A5"><span class="toc-number">3.1.1.</span> <span class="toc-text">4.1.1.  启动失败</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-2-%E6%87%92%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-number">3.1.2.</span> <span class="toc-text">4.1.2.  懒初始化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-3-%E5%AE%9A%E5%88%B6banner"><span class="toc-number">3.1.3.</span> <span class="toc-text">4.1.3.  定制banner</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-4-%E8%87%AA%E5%AE%9A%E4%B9%89SpringApplication"><span class="toc-number">3.1.4.</span> <span class="toc-text">4.1.4.  自定义SpringApplication</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-5-SpringApplication-builder"><span class="toc-number">3.1.5.</span> <span class="toc-text">4.1.5.  SpringApplication builder</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-6-%E5%BA%94%E7%94%A8%E7%9A%84%E5%8F%AF%E7%94%A8%E6%80%A7"><span class="toc-number">3.1.6.</span> <span class="toc-text">4.1.6.   应用的可用性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%B4%BB%E5%8A%A8%E7%8A%B6%E6%80%81"><span class="toc-number">3.1.6.1.</span> <span class="toc-text">活动状态</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%B1%E7%BB%AA%E7%8A%B6%E6%80%81"><span class="toc-number">3.1.6.2.</span> <span class="toc-text">就绪状态</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%A1%E7%90%86%E5%BA%94%E7%94%A8%E7%9A%84%E7%8A%B6%E6%80%81"><span class="toc-number">3.1.6.3.</span> <span class="toc-text">管理应用的状态</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-7-%E5%BA%94%E7%94%A8%E4%BA%8B%E4%BB%B6%E5%92%8C%E7%9B%91%E5%90%AC%E5%99%A8"><span class="toc-number">3.1.7.</span> <span class="toc-text">4.1.7.  应用事件和监听器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-8-Web%E7%8E%AF%E5%A2%83"><span class="toc-number">3.1.8.</span> <span class="toc-text">4.1.8.  Web环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-9-%E8%8E%B7%E5%BE%97%E5%BA%94%E7%94%A8%E5%8F%82%E6%95%B0"><span class="toc-number">3.1.9.</span> <span class="toc-text">4.1.9.  获得应用参数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-10-%E4%BD%BF%E7%94%A8ApplicationRunner%E5%92%8CCOmmandLineRunner"><span class="toc-number">3.1.10.</span> <span class="toc-text">4.1.10.  使用ApplicationRunner和COmmandLineRunner</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-11-%E5%BA%94%E7%94%A8%E9%80%80%E5%87%BA"><span class="toc-number">3.1.11.</span> <span class="toc-text">4.1.11.  应用退出</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-2-%E5%8F%AF%E5%AF%BC%E5%87%BA%E7%9A%84%E9%85%8D%E7%BD%AE"><span class="toc-number">3.2.</span> <span class="toc-text">4.2.  可导出的配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-1-%E9%85%8D%E7%BD%AE%E9%9A%8F%E6%9C%BA%E5%80%BC"><span class="toc-number">3.2.1.</span> <span class="toc-text">4.2.1.  配置随机值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-2-%E5%91%BD%E4%BB%A4%E8%A1%8C%E5%8F%82%E6%95%B0%E5%80%BC"><span class="toc-number">3.2.2.</span> <span class="toc-text">4.2.2.  命令行参数值</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-3-%E5%BA%94%E7%94%A8%E5%B1%9E%E6%80%A7%E6%96%87%E4%BB%B6"><span class="toc-number">3.2.3.</span> <span class="toc-text">4.2.3.  应用属性文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-4-%E7%89%B9%E6%AE%8A%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">3.2.4.</span> <span class="toc-text">4.2.4.  特殊配置文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-5-%E5%B1%9E%E6%80%A7%E4%B8%AD%E7%9A%84%E5%8D%A0%E4%BD%8D%E7%AC%A6"><span class="toc-number">3.2.5.</span> <span class="toc-text">4.2.5.  属性中的占位符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-7-%E4%BD%BF%E7%94%A8YAML%E6%96%87%E4%BB%B6%E6%9B%BF%E4%BB%A3properties%E6%96%87%E4%BB%B6"><span class="toc-number">3.2.6.</span> <span class="toc-text">4.2.7.  使用YAML文件替代properties文件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%A0%E8%BD%BDYAML"><span class="toc-number">3.2.6.1.</span> <span class="toc-text">加载YAML</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A4%9Aprofile%E7%9A%84YAML%E6%96%87%E6%A1%A3"><span class="toc-number">3.2.6.2.</span> <span class="toc-text">多profile的YAML文档</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-8-%E7%B1%BB%E5%9E%8B%E5%AE%89%E5%85%A8%E7%9A%84%E9%85%8D%E7%BD%AE%E5%B1%9E%E6%80%A7"><span class="toc-number">3.2.7.</span> <span class="toc-text">4.2.8.  类型安全的配置属性</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#JavaBean%E5%AD%97%E6%AE%B5%E7%BB%91%E5%AE%9A"><span class="toc-number">3.2.7.1.</span> <span class="toc-text">JavaBean字段绑定</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9E%84%E9%80%A0%E5%99%A8%E7%BB%91%E5%AE%9A"><span class="toc-number">3.2.7.2.</span> <span class="toc-text">构造器绑定</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AC%AC%E4%B8%89%E6%96%B9%E9%85%8D%E7%BD%AE"><span class="toc-number">3.2.7.3.</span> <span class="toc-text">第三方配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AE%BD%E6%9D%BE%E7%BB%91%E5%AE%9A"><span class="toc-number">3.2.7.4.</span> <span class="toc-text">宽松绑定</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%91%E5%AE%9AMap"><span class="toc-number">3.2.7.5.</span> <span class="toc-text">绑定Map</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BB%8E%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F%E7%BB%91%E5%AE%9A"><span class="toc-number">3.2.7.6.</span> <span class="toc-text">从环境变量绑定</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BB%91%E5%AE%9A%E5%A4%8D%E6%9D%82%E7%B1%BB%E5%9E%8B"><span class="toc-number">3.2.7.7.</span> <span class="toc-text">绑定复杂类型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7%E8%BD%AC%E6%8D%A2"><span class="toc-number">3.2.7.8.</span> <span class="toc-text">属性转换</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BD%AC%E6%8D%A2duration"><span class="toc-number">3.2.7.9.</span> <span class="toc-text">转换duration</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BD%AC%E6%8D%A2DataSize%E5%AF%B9%E8%B1%A1"><span class="toc-number">3.2.7.10.</span> <span class="toc-text">转换DataSize对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ConfigurationProperties%E6%B3%A8%E8%A7%A3%E9%AA%8C%E8%AF%81"><span class="toc-number">3.2.7.11.</span> <span class="toc-text">@ConfigurationProperties注解验证</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ConfigurationProperties%E5%92%8C-Value%E6%AF%94%E8%BE%83"><span class="toc-number">3.2.7.12.</span> <span class="toc-text">@ConfigurationProperties和@Value比较</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-3-Profiles"><span class="toc-number">3.3.</span> <span class="toc-text">4.3.  Profiles</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8%E4%B8%8D%E5%90%8C%E7%8E%AF%E5%A2%83%E4%B8%8B%E4%BD%BF%E7%94%A8%E9%85%8D%E7%BD%AE"><span class="toc-number">3.3.0.1.</span> <span class="toc-text">在不同环境下使用配置</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-4-Logging"><span class="toc-number">3.4.</span> <span class="toc-text">4.4.  Logging</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-1-%E6%97%A5%E5%BF%97%E6%A0%BC%E5%BC%8F"><span class="toc-number">3.4.1.</span> <span class="toc-text">4.4.1.  日志格式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-2-%E6%8E%A7%E5%88%B6%E5%8F%B0%E8%BE%93%E5%87%BA"><span class="toc-number">3.4.2.</span> <span class="toc-text">4.4.2.  控制台输出</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-3-%E9%A2%9D%E5%A4%96%E8%BE%93%E5%87%BA%E5%88%B0%E6%96%87%E4%BB%B6"><span class="toc-number">3.4.3.</span> <span class="toc-text">4.4.3.   额外输出到文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-4-%E6%97%A5%E5%BF%97%E7%AD%89%E7%BA%A7"><span class="toc-number">3.4.4.</span> <span class="toc-text">4.4.4.  日志等级</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%B6%E4%BB%96%E6%97%A5%E5%BF%97%E7%9B%B8%E5%85%B3"><span class="toc-number">3.4.5.</span> <span class="toc-text">其他日志相关</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-5-%E5%9B%BD%E9%99%85%E5%8C%96"><span class="toc-number">3.5.</span> <span class="toc-text">4.5.  国际化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-6-JSON"><span class="toc-number">3.6.</span> <span class="toc-text">4.6.   JSON</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-7-web%E5%BA%94%E7%94%A8"><span class="toc-number">3.7.</span> <span class="toc-text">4.7.  web应用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-7-1-Spring-MVC%E6%A1%86%E6%9E%B6"><span class="toc-number">3.7.1.</span> <span class="toc-text">4.7.1.  Spring MVC框架</span></a></li></ol></li></ol></li></ol></div></div></div><header class="post-bg" id="page-header" style="background-image: url(https://dzone.com/storage/temp/12434118-spring-boot-logo.png)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">crazyStrome的博客</a></span><span id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><span class="close" id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">Spring Boot笔记</div></div><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2020-11-06T02:44:13.340Z" title="发表于 2020-11-06 10:44:13">2020-11-06</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2020-10-14T16:00:00.000Z" title="更新于 2020-10-15 00:00:00">2020-10-15</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Spring/">Spring</a></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h1 id="2-SpringBoot介绍"><a href="#2-SpringBoot介绍" class="headerlink" title="2.  SpringBoot介绍"></a>2.  SpringBoot介绍</h1><h2 id="2-2-系统要求"><a href="#2-2-系统要求" class="headerlink" title="2.2.  系统要求"></a>2.2.  系统要求</h2><p>Spring Boot2.3.3需要Java 8以上，Spring框架5.2.7以上。</p>
<p>构建工具支持Maven3.3以上、Gradle 6.3以上。</p>
<h2 id="2-2-1-支持的servlet版本"><a href="#2-2-1-支持的servlet版本" class="headerlink" title="2.2.1.  支持的servlet版本"></a>2.2.1.  支持的servlet版本</h2><table>
<thead>
<tr>
<th align="left">Name</th>
<th align="left">Servlet Version</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Tomcat 9.0</td>
<td align="left">4.0</td>
</tr>
<tr>
<td align="left">Jetty 9.4</td>
<td align="left">3.1</td>
</tr>
<tr>
<td align="left">Undertow 2.0</td>
<td align="left">4.0</td>
</tr>
</tbody></table>
<h3 id="2-4-3-写代码"><a href="#2-4-3-写代码" class="headerlink" title="2.4.3.  写代码"></a>2.4.3.  写代码</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Example</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">hi</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hello world&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(Example.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>@RestController是@Controller和@Responsebody的结合，说明该类下的方法直接返回相关内容，不用做jsp的映射。</p>
<p>@GetMapping是路径映射相关的注解，相关内容见Spring MVC。</p>
<p>@EnableAutoConfiguration其中最关键的要属@Import(AutoConfigurationImportSelector.class)，借助AutoConfigurationImportSelector，@EnableAutoConfiguration可以帮助SpringBoot应用将所有符合条件的@Configuration配置都加载到当前SpringBoot创建并使用的IoC容器。</p>
<p>Application.run(): <a target="_blank" rel="noopener" href="https://www.jianshu.com/p/c2789f1548ab">https://www.jianshu.com/p/c2789f1548ab</a></p>
<h1 id="3-使用SpringBoot"><a href="#3-使用SpringBoot" class="headerlink" title="3.  使用SpringBoot"></a>3.  使用SpringBoot</h1><h2 id="3-2-构建代码"><a href="#3-2-构建代码" class="headerlink" title="3.2.  构建代码"></a>3.2.  构建代码</h2><h3 id="3-2-1-使用default包路径"><a href="#3-2-1-使用default包路径" class="headerlink" title="3.2.1.  使用default包路径"></a>3.2.1.  使用default包路径</h3><p>建议使用包路径com.example.project，不然@Component等扫描注解会失效。</p>
<h3 id="3-2-2-定位主应用类"><a href="#3-2-2-定位主应用类" class="headerlink" title="3.2.2.  定位主应用类"></a>3.2.2.  定位主应用类</h3><p>主 应用类一般使用@SpringBootApplication修饰类，也可以是用@EnableAutoConfiguration和@ComponentScan来修饰。两者是等效的。</p>
<p>@SpringBootApplication修饰的类中要定义main方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.myapplication;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(Application.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="3-3-配置类"><a href="#3-3-配置类" class="headerlink" title="3.3.  配置类"></a>3.3.  配置类</h2><p>推荐使用java config配置类。使用@Configuration修饰。通常定义了main方法的类作为首选配置类。</p>
<h3 id="3-3-1-导入其他配置类"><a href="#3-3-1-导入其他配置类" class="headerlink" title="3.3.1.  导入其他配置类"></a>3.3.1.  导入其他配置类</h3><p>@Import可以导入其他配置类</p>
<h3 id="3-3-2-导入XML配置数据"><a href="#3-3-2-导入XML配置数据" class="headerlink" title="3.3.2.  导入XML配置数据"></a>3.3.2.  导入XML配置数据</h3><p>@ImportResource可以在配置类中加载XML配置数据。</p>
<h2 id="3-4-自动配置"><a href="#3-4-自动配置" class="headerlink" title="3.4.  自动配置"></a>3.4.  自动配置</h2><p>自动配置（auto-configuration）是Spring Boot最重要的特性之一，因为该特性会根据应用的classpath（这个主要是根据maven pom.xml决定），annotations和其他的一些java配置描述符自动配置Spring Boot应用。例如，如果在你的classpath中配置了H2（在pom.xml文件中添加了H2的依赖），你不必维护任何数据连接，Spring Boot会自动配置一个内存数据库。<br>需要使用@EnableAutoConfiguration或者@SpringBootApplication注解添加到配置类上。</p>
<p>@EnableAutoConfiguration或者@SpringBootApplication只能使用一次，建议加到主配置类上。</p>
<h3 id="3-4-1-替代自动配置内容"><a href="#3-4-1-替代自动配置内容" class="headerlink" title="3.4.1.  替代自动配置内容"></a>3.4.1.  替代自动配置内容</h3><p>Auto-configuration是非侵入性的，在任何时候你都可以开始定义你自己的配置来替换auto-configuration的特定部分。比如说，如果你添加了自己的DataSource bean，默认嵌入的数据库支持将会失效。</p>
<h3 id="3-4-2-禁用执行的自动配置类"><a href="#3-4-2-禁用执行的自动配置类" class="headerlink" title="3.4.2.  禁用执行的自动配置类"></a>3.4.2.  禁用执行的自动配置类</h3><p>如果不想使用特殊的自动配置类，可以在@SpringBootApplication或@EnableAutoConfiguration禁用他们。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.jdbc.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication(exclude=&#123;DataSourceAutoConfiguration.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyApplication</span> </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果需要禁用的配置类没有在classpath中，则可以通过excludeName属性来指定全路径名。</p>
<h2 id="3-5-Spring-Beans和DI（依赖注入）"><a href="#3-5-Spring-Beans和DI（依赖注入）" class="headerlink" title="3.5.  Spring Beans和DI（依赖注入）"></a>3.5.  Spring Beans和DI（依赖注入）</h2><p>可以使用Spring IoC的相关注解。</p>
<p>@ComponentScan和@Autowired</p>
<h2 id="3-6-使用-SpringBootApplication注解"><a href="#3-6-使用-SpringBootApplication注解" class="headerlink" title="3.6.  使用@SpringBootApplication注解"></a>3.6.  使用@SpringBootApplication注解</h2><p>@SpringBootApplication注解实现了如下特性：</p>
<ul>
<li>@EnableAutoConfiguration：实现自动配置</li>
<li>@ComponentScan：包扫描</li>
<li>@Configuration：配置类</li>
</ul>
<p>如果不想使用其中的某一个特性，可以不适用@SpringBootApplication注解。</p>
<h2 id="3-8-开发者工具"><a href="#3-8-开发者工具" class="headerlink" title="3.8.  开发者工具"></a>3.8.  开发者工具</h2><p>Maven</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>Gradle</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    developmentOnly(<span class="string">&quot;org.springframework.boot:spring-boot-devtools&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当运行一个应用时，开发者工具默认是关闭的。</p>
<p>开发者工具在maven中设置为optional或者在gradle中设置为develpomentOnly，可以防止该组件被用在其他模块上。</p>
<h3 id="3-8-1-默认属性"><a href="#3-8-1-默认属性" class="headerlink" title="3.8.1.  默认属性"></a>3.8.1.  默认属性</h3><p>缓存会导致开发者在开发过程中无法看到新添加的变化，spring boot开发工具默认禁用了缓存选项。</p>
<p>缓存选项是在application.properties文件中配置的。</p>
<h3 id="3-8-2-自动重启"><a href="#3-8-2-自动重启" class="headerlink" title="3.8.2.  自动重启"></a>3.8.2.  自动重启</h3><p>使用spring-boot-devtools的应用当classpath的文件变化之后会自动重启。classpath的任何路径都是被监控其变化的。但是，那些准确的资源比如静态资源和视图模板是不需要重启应用的。</p>
<p>在eclipse中保存已修改文件会导致重启。IDEA中构建项目会导致重启。</p>
<p>Spring Boot通过两个类加载器提供重启技术。没有改变的类（比如第三方jar）使用base classloader。正在开发的类被加载进restart classloader。当应用重启时，restart classloader被丢弃而创建一个新的restart classloader。这个方法意味着应用重启的速度要比冷启动快很多，因为base classloader已经被建立而且填充了。</p>
<h4 id="每次重启记录日志"><a href="#每次重启记录日志" class="headerlink" title="每次重启记录日志"></a>每次重启记录日志</h4><p>默认开启。</p>
<p>关闭，在application.properties配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.devtools.restart.log-condition-evaluation-delta=false</span><br></pre></td></tr></table></figure>

<h4 id="exclude属性"><a href="#exclude属性" class="headerlink" title="exclude属性"></a>exclude属性</h4><p>该属性下设置的文件在被改变时不会触发应用重启，而只是触发一个实时加载。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.devtools.restart.exclude=static/**,public/**</span><br></pre></td></tr></table></figure>

<h4 id="监听额外路径"><a href="#监听额外路径" class="headerlink" title="监听额外路径"></a>监听额外路径</h4><p>使用spring.devtools.restart.additional-paths来监听不在classpat中的文件路径。</p>
<h4 id="关闭重启特性"><a href="#关闭重启特性" class="headerlink" title="关闭重启特性"></a>关闭重启特性</h4><p>如果不想使用自动重启特性，可以通过spring.devtools.restart.enabled关闭。</p>
<p>如果想完全关闭重启特性，可以：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    System.setProperty(<span class="string">&quot;spring.devtools.restart.enabled&quot;</span>, <span class="string">&quot;false&quot;</span>);</span><br><span class="line">    SpringApplication.run(MyApp.class, args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="使用触发文件"><a href="#使用触发文件" class="headerlink" title="使用触发文件"></a>使用触发文件</h4><p>如果需要在某些特殊的时刻触发重启，则需要一个触发文件。触发文件是当你想触发重启检查时该文件必须被修改过。</p>
<p>该文件的任何更新都会触发检查，但是只有Devtools检测到它有任务需要执行才会重启。</p>
<p>设置 <code>spring.devtools.restart.trigger-file</code> 指向触发文件。</p>
<p>IDEA中触发文件的设置如下：<a target="_blank" rel="noopener" href="https://www.jetbrains.com/help/idea/spring-boot.html#">https://www.jetbrains.com/help/idea/spring-boot.html#</a></p>
<h4 id="自定义重启类加载器"><a href="#自定义重启类加载器" class="headerlink" title="自定义重启类加载器"></a>自定义重启类加载器</h4><p>如果自己开发的有很多个模块，而jar的改变需要使用restart classloader。则可以创建一个 <code>META-INF/spring-devtools.properties</code>文件，在该文件中，include表示的是需要放到restart classloader的东西，exclude是需要放到base classloader的东西。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">restart.exclude.companycommonlibs&#x3D;&#x2F;mycorp-common-[\\w\\d-\.]+\.jar</span><br><span class="line">restart.include.projectcommon&#x3D;&#x2F;mycorp-myproj-[\\w\\d-\.]+\.jar</span><br></pre></td></tr></table></figure>

<h4 id="局限性"><a href="#局限性" class="headerlink" title="局限性"></a>局限性</h4><p>重启特性在使用ObjectinputStream反序列化对象时会出问题，如果需要反序列化数据，需要使用Spring 的ConfigurableObjectInputStream，同时结合Thread.currentThread().getContextClassLoader()。</p>
<h3 id="3-8-3-实时加载"><a href="#3-8-3-实时加载" class="headerlink" title="3.8.3.  实时加载"></a>3.8.3.  实时加载</h3><p>spring-boot-devtools包括一个集成的实时加载服务器，可以让浏览器刷新资源。</p>
<p>关闭可以通过spring.devtools.livereload.enabled实现。</p>
<h3 id="3-8-4-全局设置"><a href="#3-8-4-全局设置" class="headerlink" title="3.8.4.  全局设置"></a>3.8.4.  全局设置</h3><p>可以把开发工具设置放到$HOME/.config/spring-boot目录下。</p>
<ol>
<li><code>spring-boot-devtools.properties</code></li>
<li><code>spring-boot-devtools.yaml</code></li>
<li><code>spring-boot-devtools.yml</code></li>
</ol>
<p>如果devtools的配置文件不在$HOME/.config/spring-boot目录下，那么会查找$HOME下的.spring-boot-devtools.properties文件。</p>
<h4 id="配置文件系统监视器"><a href="#配置文件系统监视器" class="headerlink" title="配置文件系统监视器"></a>配置文件系统监视器</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">spring.devtools.restart.poll-interval&#x3D;2s</span><br><span class="line">spring.devtools.restart.quiet-period&#x3D;1s</span><br></pre></td></tr></table></figure>

<p>现在每2秒轮询一次受监视的类路径目录以查找更改，并保持1秒钟的静默时间以确保没有其他类更改。</p>
<h3 id="3-8-5-远程应用"><a href="#3-8-5-远程应用" class="headerlink" title="3.8.5.  远程应用"></a>3.8.5.  远程应用</h3><p>基本和本地应用配置差不多。</p>
<h1 id="4-SpringBoot特性"><a href="#4-SpringBoot特性" class="headerlink" title="4.  SpringBoot特性"></a>4.  SpringBoot特性</h1><h2 id="4-1-SpringApplication"><a href="#4-1-SpringApplication" class="headerlink" title="4.1.  SpringApplication"></a>4.1.  SpringApplication</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    SpringApplication.run(MySpringConfiguration.class, args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>用来启动一个SpringBoot应用。</p>
<p>如果不想看到启动时的log信息，可以将spring.main.log-startup-info设置为false。</p>
<p>也可以重写SpringApplication子类的logStartupInfo方法。</p>
<h3 id="4-1-1-启动失败"><a href="#4-1-1-启动失败" class="headerlink" title="4.1.1.  启动失败"></a>4.1.1.  启动失败</h3><p>如果应用启动失败，可以注册FailureAnalyzers来获得一个提供具体错误信息和改正操作的机会。</p>
<p>自己实现一个子类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyFailureAnalyzer</span> <span class="keyword">implements</span> <span class="title">FailureAnalyzer</span> </span>&#123;</span><br><span class="line">    Logger logger = Logger.getLogger(<span class="keyword">this</span>.getClass().getName());</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> FailureAnalysis <span class="title">analyze</span><span class="params">(Throwable failure)</span> </span>&#123;</span><br><span class="line">        logger.info(<span class="string">&quot;Some thing error happened: &quot;</span> + failure);</span><br><span class="line">        FailureAnalysis failureAnalysis = <span class="keyword">new</span> FailureAnalysis(<span class="string">&quot;description&quot;</span>, <span class="string">&quot;action&quot;</span>, failure);</span><br><span class="line">        <span class="keyword">return</span> failureAnalysis;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在/resources/META-INF/中添加spring.factories</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">org.springframework.boot.diagnostics.FailureAnalyzer</span>=<span class="string">com.example.demo.MyFailureAnalyzer</span></span><br></pre></td></tr></table></figure>

<h3 id="4-1-2-懒初始化"><a href="#4-1-2-懒初始化" class="headerlink" title="4.1.2.  懒初始化"></a>4.1.2.  懒初始化</h3><p>懒初始化开启之后，只有用户使用bean时才会被初始化。因此，懒初始化可以减少应用的启动时间。在web应用中，懒初始化会导致很多web相关的bean只有在收到HTTP请求时才初始化。</p>
<p>懒初始化的一个缺点是它会延迟发现问题的时间。如果一个没有被配置的bean是懒初始化的，那么错误不会在应用开始运行时出现。而且懒初始化下，需要注意JVM的内存容量，防止懒初始化下的bean太多。所以懒初始化是默认不开启的，而且开启时需要精确估计JVM的内存容量。</p>
<p>懒初始化可以通过SpringApplicationBuilder的lazyInitialization方法设置或者通过SpringApplication的setLazyInitialization方法设置。也可以通过<strong>spring.main.lazy-initialization</strong>=true设置。</p>
<p>如果在全局懒初始化下需要确定某一个bean不被懒初始化，可以使用@Lazy(false)注解。</p>
<h3 id="4-1-3-定制banner"><a href="#4-1-3-定制banner" class="headerlink" title="4.1.3.  定制banner"></a>4.1.3.  定制banner</h3><p>可以自定义springboot初始化时输出的条幅。</p>
<p>在classpath中添加banner.txt，然后可以使用如下变量：</p>
<table>
<thead>
<tr>
<th><code>$&#123;application.version&#125;</code></th>
<th>The version number of your application, as declared in <code>MANIFEST.MF</code>. For example, <code>Implementation-Version: 1.0</code> is printed as <code>1.0</code>.</th>
</tr>
</thead>
<tbody><tr>
<td><code>$&#123;application.formatted-version&#125;</code></td>
<td>The version number of your application, as declared in <code>MANIFEST.MF</code> and formatted for display (surrounded with brackets and prefixed with <code>v</code>). For example <code>(v1.0)</code>.</td>
</tr>
<tr>
<td><code>$&#123;spring-boot.version&#125;</code></td>
<td>The Spring Boot version that you are using. For example <code>2.3.2.BUILD-SNAPSHOT</code>.</td>
</tr>
<tr>
<td><code>$&#123;spring-boot.formatted-version&#125;</code></td>
<td>The Spring Boot version that you are using, formatted for display (surrounded with brackets and prefixed with <code>v</code>). For example <code>(v2.3.2.BUILD-SNAPSHOT)</code>.</td>
</tr>
<tr>
<td><code>$&#123;Ansi.NAME&#125;</code> (or <code>$&#123;AnsiColor.NAME&#125;</code>, <code>$&#123;AnsiBackground.NAME&#125;</code>, <code>$&#123;AnsiStyle.NAME&#125;</code>)</td>
<td>Where <code>NAME</code> is the name of an ANSI escape code. See <a target="_blank" rel="noopener" href="https://github.com/spring-projects/spring-boot/tree/2.3.x/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/ansi/AnsiPropertySource.java"><code>AnsiPropertySource</code></a> for details.</td>
</tr>
<tr>
<td><code>$&#123;application.title&#125;</code></td>
<td>The title of your application, as declared in <code>MANIFEST.MF</code>. For example <code>Implementation-Title: MyApp</code> is printed as <code>MyApp</code>.</td>
</tr>
</tbody></table>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$&#123;AnsiColor.BRIGHT_YELLOW&#125;</span><br><span class="line">$&#123;spring-boot.version&#125;</span><br><span class="line">////////////////////////////////////////////////////////////////////</span><br><span class="line">//                          _ooOoo_                               //</span><br><span class="line">//                         o8888888o                              //</span><br><span class="line">//                         88&quot; . &quot;88                              //</span><br><span class="line">//                         (| ^_^ |)                              //</span><br><span class="line">//                         O\  =  /O                              //</span><br><span class="line">//                      ____/`---&#x27;\____                           //</span><br><span class="line">//                    .&#x27;  \\|     |//  `.                         //</span><br><span class="line">//                   /  \\|||  :  |||//  \                        //</span><br><span class="line">//                  /  _||||| -:- |||||-  \                       //</span><br><span class="line">//                  |   | \\\  -  /// |   |                       //</span><br><span class="line">//                  | \_|  &#x27;&#x27;\---/&#x27;&#x27;  |   |                       //</span><br><span class="line">//                  \  .-\__  `-`  ___/-. /                       //</span><br><span class="line">//                ___`. .&#x27;  /--.--\  `. . ___                     //</span><br><span class="line">//              .&quot;&quot; &#x27;&lt;  `.___\_&lt;|&gt;_/___.&#x27;  &gt;&#x27;&quot;&quot;.                  //</span><br><span class="line">//            | | :  `- \`.;`\ _ /`;.`/ - ` : | |                 //</span><br><span class="line">//            \  \ `-.   \_ __\ /__ _/   .-` /  /                 //</span><br><span class="line">//      ========`-.____`-.___\_____/___.-`____.-&#x27;========         //</span><br><span class="line">//                           `=---=&#x27;                              //</span><br><span class="line">//      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^        //</span><br><span class="line">//            佛祖保佑       永不宕机      永无BUG                　　//</span><br><span class="line">////////////////////////////////////////////////////////////////////</span><br></pre></td></tr></table></figure>

<p>如果不想输出banner，则可以使用springApplication.setBannerMode来关闭。</p>
<p>或者设置spring.main.banner-mode属性来控制banner输出到console、log或者off关闭。</p>
<h3 id="4-1-4-自定义SpringApplication"><a href="#4-1-4-自定义SpringApplication" class="headerlink" title="4.1.4.  自定义SpringApplication"></a>4.1.4.  自定义SpringApplication</h3><p>可以实现一个SpringApplication的对象，然后自定义。</p>
<p>例如，关闭banner。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    SpringApplication app = <span class="keyword">new</span> SpringApplication(MySpringConfiguration.class);</span><br><span class="line">    app.setBannerMode(Banner.Mode.OFF);</span><br><span class="line">    app.run(args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>传递给SpringApplication的构造参数的@Configuration的配置类或者是XML配置文件的引用。</p>
<p>也可以使用application.properties文件来定义SpringApplication。</p>
<h3 id="4-1-5-SpringApplication-builder"><a href="#4-1-5-SpringApplication-builder" class="headerlink" title="4.1.5.  SpringApplication builder"></a>4.1.5.  SpringApplication builder</h3><p>SpringApplicationBuilder可以用来构造SpringApplication。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> SpringApplicationBuilder()</span><br><span class="line">        .sources(Parent.class)</span><br><span class="line">        .child(Application.class)</span><br><span class="line">        .bannerMode(Banner.Mode.OFF)</span><br><span class="line">        .run(args);</span><br></pre></td></tr></table></figure>

<h3 id="4-1-6-应用的可用性"><a href="#4-1-6-应用的可用性" class="headerlink" title="4.1.6.   应用的可用性"></a>4.1.6.   应用的可用性</h3><p>通过向bean注入ApplicationAvailability的接口来获得可用性。</p>
<h4 id="活动状态"><a href="#活动状态" class="headerlink" title="活动状态"></a>活动状态</h4><p>应用程序的“活动”状态表明其内部状态是否允许其正常运行，或者在当前出现故障时自行恢复。损坏的“活动”状态意味着应用程序处于无法恢复的状态，并且基础结构应重新启动应用程序。</p>
<p>Spring Boot应用程序的内部状态主要由Spring ApplicationContext表示。如果应用程序上下文已成功启动，则Spring Boot会假定该应用程序处于有效状态。刷新上下文后，应用程序即被视为处于活动状态，请参阅Spring Boot应用程序生命周期和相关的应用程序事件。</p>
<h4 id="就绪状态"><a href="#就绪状态" class="headerlink" title="就绪状态"></a>就绪状态</h4><p>应用程序的“就绪”状态表明该应用程序是否已准备好处理流量。失败的“就绪”状态告诉平台当前不应将流量路由到应用程序。这通常发生在启动过程中，正在处理CommandLineRunner和ApplicationRunner组件时，或者在应用程序认为它太忙以至于无法获得额外流量的任何时候。</p>
<p>预期在启动期间运行的任务应由CommandLineRunner和ApplicationRunner组件执行，而不是使用Spring组件生命周期回调（如@PostConstruct）执行。</p>
<h4 id="管理应用的状态"><a href="#管理应用的状态" class="headerlink" title="管理应用的状态"></a>管理应用的状态</h4><p>通过注入ApplicationAvailability接口并在其上调用方法，应用程序组件可以随时检索当前的可用性状态。应用程序通常会希望监听状态更新或更新应用程序的状态。</p>
<h3 id="4-1-7-应用事件和监听器"><a href="#4-1-7-应用事件和监听器" class="headerlink" title="4.1.7.  应用事件和监听器"></a>4.1.7.  应用事件和监听器</h3><p>SpringApplication会在一些事件（ContextRefreshedEvent）发送额外的应用事件。</p>
<p>有些事件在ApplicationContext生成之前就被触发了。可以通过SpringApplication.addListeners(..)方法或者SpringApplicationBuilder.listeners(..)方法注册。</p>
<p>如果想自动注册监听器，可以在/META-INF/spring.factories中添加监听器。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.context.ApplicationListener=com.example.project.MyListener</span><br></pre></td></tr></table></figure>

<p>应用的事件是以下面的顺序发布的。</p>
<ol>
<li>在任何process开始之前，发送ApplicationStartingEvent、</li>
<li>当Environment在context中被使用时发送ApplicationEnvironmentPreparedEvent。</li>
<li>当ApplicationContext准备好了，而且ApplicationContextInitializers被调用时会发送ApplicationContextInitializedEvent。</li>
<li>在刷新之前，bean定义被加载之后会发送ApplicationPreparedEvent。</li>
<li>在context刷新后但是任何应用被调用之前会发送ApplicationStartedEvent。</li>
<li>应用状态是live时会发送携带LivenessState.CORRECT的AvailabilityChangeEvent。</li>
<li>当任何应用或者命令行运行体被调用，会发送ApplicationReadyEvent。</li>
<li>当携带有ReadinessState.ACCEPTING_TRAFFIC的AvailabilityChangeEvent的事件被发送时表示应用已经准备好接收请求了。</li>
<li>如果在启动时出现异常则会发送ApplicationFailedEvent。</li>
</ol>
<p>上面的包括绑定到SpringApplication的<code>SpringApplicationEvent</code>s 。</p>
<p>下面的事件是在ApplicationPreparedEvent之后但是ApplicationStartedEvent之前发布的。</p>
<ol>
<li>当ApplicationContext刷新时会发送ContextRefreshedEvent。</li>
<li>当WebServer准备好时会发送WebServerInitializedEvent。例如ServletWebServerInitializedEvent和ReactiveWebServerInitializedEvent。</li>
</ol>
<p>SpringBoot使用事件来处理各种任务。</p>
<p>应用程序事件是通过使用Spring Framework的事件发布机制发送的。此机制的一部分确保在子级上下文中发布给侦听器的事件也可以在任何祖先上下文中发布给侦听器。结果，如果您的应用程序使用SpringApplication实例的层次结构，则侦听器可能会收到同一类型的应用程序事件的多个实例。</p>
<p>为了使您的侦听器能够区分其上下文的事件和后代上下文的事件，它应请求注入其应用程序上下文，然后将注入的上下文与事件的上下文进行比较。可以通过实现ApplicationContextAware来注入上下文，或者，如果侦听器是bean，则可以使用@Autowired注入上下文。</p>
<h3 id="4-1-8-Web环境"><a href="#4-1-8-Web环境" class="headerlink" title="4.1.8.  Web环境"></a>4.1.8.  Web环境</h3><p>不同的环境下使用不同的ApplicationContext。</p>
<p>如果有Spring MVC，则使用AnnotationConfigServletWebServerApplicationContext。</p>
<p>如果使用Spring WebFlux，则使用AnnotationConfigReactiveWebServerApplicationContext。</p>
<p>否则使用AnnotationConfigApplicationContext。</p>
<p>可以通过<code>setWebApplicationType(WebApplicationType)</code>.设置类型。</p>
<p>setApplicationContextClass(…)可以完全控制ApplicationContext类型。</p>
<p>在JUnit测试中，setWebApplicationType(WebApplicationType.NONE)。</p>
<h3 id="4-1-9-获得应用参数"><a href="#4-1-9-获得应用参数" class="headerlink" title="4.1.9.  获得应用参数"></a>4.1.9.  获得应用参数</h3><p>额如果想要获得传递给<code>SpringApplication.run(…)</code>的参数，可以注入一个org.springframework.boot.ApplicationArguments的bean。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.boot.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBean</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyBean</span><span class="params">(ApplicationArguments args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> debug = args.containsOption(<span class="string">&quot;debug&quot;</span>);</span><br><span class="line">        List&lt;String&gt; files = args.getNonOptionArgs();</span><br><span class="line">        <span class="comment">// if run with &quot;--debug logfile.txt&quot; debug=true, files=[&quot;logfile.txt&quot;]</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-1-10-使用ApplicationRunner和COmmandLineRunner"><a href="#4-1-10-使用ApplicationRunner和COmmandLineRunner" class="headerlink" title="4.1.10.  使用ApplicationRunner和COmmandLineRunner"></a>4.1.10.  使用ApplicationRunner和COmmandLineRunner</h3><p>这两个接口都有run方法，并且在SpringApplication.run()方法完成前被调用。</p>
<p>CommandLineRUnner接口提供获得字符串数组参数的实现。</p>
<p>ApplicationRunner则是通过ApplicationArguments获取参数。</p>
<p>可以使用Orderd接口对他们进行排序或者使用@Order注解。</p>
<h3 id="4-1-11-应用退出"><a href="#4-1-11-应用退出" class="headerlink" title="4.1.11.  应用退出"></a>4.1.11.  应用退出</h3><p>每个SpringApplication都会注册一个和JVM相关的钩子，来保证ApplicationContext优雅地关闭。</p>
<p>以下代码可以生成一个退出码。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExitCodeApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ExitCodeGenerator <span class="title">exitCodeGenerator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> () -&gt; <span class="number">42</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.exit(SpringApplication.exit(SpringApplication.run(ExitCodeApplication.class, args)));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>异常实现ExitCodeGenerator接口也可以生成返回码。</p>
<h2 id="4-2-可导出的配置"><a href="#4-2-可导出的配置" class="headerlink" title="4.2.  可导出的配置"></a>4.2.  可导出的配置</h2><p>Spring Boot可以导出配置，这样可以在不同的环境中使用相同的应用代码。可以使用properties文件，YAML文件，环境变量或者命令行参数来导出设置。属性值可以通过@Value直接注入到bean上。</p>
<p>Spring Boot使用一个特殊的PropertySource顺序来允许属性值的覆盖。属性从下面的顺序被考虑。</p>
<ol>
<li>当devtools被激活时，放在$HOME/.config/spring-boot下的开发工具全局配置。</li>
<li>@TestPropertySource注解中的配置</li>
<li>命令行参数</li>
<li>SPRING_APPLICATION_JSON中的属性。</li>
<li>ServletConfig初始化参数</li>
<li>ServletContext初始化参数</li>
<li>JNDI参数</li>
<li>Java系统属性（System.getProperties()）</li>
<li>系统环境变量</li>
<li>random.*中的RandomValuePropertySource</li>
<li>包jar外的特殊配置文件application-{profile}.properties或YAML文件</li>
<li>包jar内的特殊配置文件application-{profile}.properties或YAML文件</li>
<li>包jar外的应用配置文件application.properties</li>
<li>包jar内的应用配置文件application.properties</li>
<li>@PropertySource注解中的配置文件</li>
<li>默认配置文件：SpringApplication.setDefaultProperties</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.stereotype.*;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBean</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;name&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以在application.properties中设置name字段，也可以在命令行参数中使用java -jar app.jar —name=”Spring”。</p>
<p>Spring Boot也支持加载通配符的路径中的配置文件。</p>
<h3 id="4-2-1-配置随机值"><a href="#4-2-1-配置随机值" class="headerlink" title="4.2.1.  配置随机值"></a>4.2.1.  配置随机值</h3><p>RandomValuePropertySource用来注入随机数很方便。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">my.secret=$&#123;random.value&#125;</span><br><span class="line">my.number=$&#123;random.<span class="keyword">int</span>&#125;</span><br><span class="line">my.bignumber=$&#123;random.<span class="keyword">long</span>&#125;</span><br><span class="line">my.uuid=$&#123;random.uuid&#125;</span><br><span class="line">my.number.less.than.ten=$&#123;random.<span class="keyword">int</span>(<span class="number">10</span>)&#125;</span><br><span class="line">my.number.in.range=$&#123;random.<span class="keyword">int</span>[<span class="number">1024</span>,<span class="number">65536</span>]&#125;</span><br></pre></td></tr></table></figure>

<p>左开右闭区间。</p>
<h3 id="4-2-2-命令行参数值"><a href="#4-2-2-命令行参数值" class="headerlink" title="4.2.2.  命令行参数值"></a>4.2.2.  命令行参数值</h3><p>如果想关闭，则通过<code>SpringApplication.setAddCommandLineProperties(false)</code>.</p>
<h3 id="4-2-3-应用属性文件"><a href="#4-2-3-应用属性文件" class="headerlink" title="4.2.3.  应用属性文件"></a>4.2.3.  应用属性文件</h3><p>SpringApplication加载如下位置的application.properties文件并把它们添加到spring的环境中。</p>
<ol>
<li>当前目录的/config子目录</li>
<li>当前目录</li>
<li>classpath的/config目录</li>
<li>classpath根路径。</li>
</ol>
<p>这个列表是通过优先权排序的。</p>
<p>可以使用YAML文件来替代.properties文件</p>
<p>如果不想用这个文件名，可以在命令行参数中传入其他名字，也可以传入其他路径。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ java -jar myproject.jar --spring.config.name=myproject</span><br><span class="line">$ java -jar myproject.jar --spring.config.location=classpath:/default.properties,classpath:/override.properties</span><br></pre></td></tr></table></figure>

<p>如果spring.config.location包含目录（而不是文件），则它们应以/结尾（并且在运行时，应在加载之前附加从spring.config.name生成的名称，包括特定于配置文件的文件名）。 spring.config.location中指定的文件按原样使用，不支持特定于配置文件的变体，并且被任何特定于配置文件的属性覆盖。</p>
<p>配置位置以相反的顺序搜索。默认情况下，配置的位置是classpath：/，classpath：/ config /，file：./，file：./ config / * /，file：./ config /。结果搜索顺序如下：</p>
<ol>
<li><code>file:./config/</code></li>
<li><code>file:./config/*/</code></li>
<li><code>file:./</code></li>
<li><code>classpath:/config/</code></li>
<li><code>classpath:/</code></li>
</ol>
<p>使用spring.config.location配置自定义配置位置后，它们将替换默认位置。例如，如果spring.config.location配置为值classpath：/ custom-config /，file：./ custom-config /，则搜索顺序如下：</p>
<ol>
<li><code>file:./custom-config/</code></li>
<li><code>classpath:custom-config/</code></li>
</ol>
<p>另外，当使用spring.config.additional-location配置自定义配置位置时，除默认位置外，还会使用它们。在默认位置之前搜索其他位置。例如，如果配置了classpath：/ custom-config /，file：./ custom-config /的其他位置，则搜索顺序如下：</p>
<ol>
<li><code>file:./custom-config/</code></li>
<li><code>classpath:custom-config/</code></li>
<li><code>file:./config/</code></li>
<li><code>file:./config/*/</code></li>
<li><code>file:./</code></li>
<li><code>classpath:/config/</code></li>
<li><code>classpath:/</code></li>
</ol>
<p>可以看到首先选取当前路径下的文件，然后才是classpath中的文件。</p>
<h3 id="4-2-4-特殊配置文件"><a href="#4-2-4-特殊配置文件" class="headerlink" title="4.2.4.  特殊配置文件"></a>4.2.4.  特殊配置文件</h3><p>除了application.properties文件之外，还可以使用以下命名约定来定义特定于配置文件的属性：application- {profile} .properties。如果没有设置活动配置文件，则环境具有一组默认配置文件（默认为[默认]）。换句话说，如果未显式激活任何概要文件，那么将从application-default.properties中加载属性。 特定于配置文件的属性是从与标准application.properties相同的位置加载的，特定于配置文件的文件始终会覆盖非特定文件，而无论特定于配置文件的文件是位于打包jar的内部还是外部。 如果指定了多个配置文件，则采用后赢策略。例如，在通过SpringApplication API配置的配置文件之后，添加了spring.profiles.active属性指定的配置文件，因此具有优先权。</p>
<h3 id="4-2-5-属性中的占位符"><a href="#4-2-5-属性中的占位符" class="headerlink" title="4.2.5.  属性中的占位符"></a>4.2.5.  属性中的占位符</h3><p>定义的属性可以引用之前定义的属性，需要使用占位符${}</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">app.name</span>=<span class="string">MyApp</span></span><br><span class="line"><span class="meta">app.description</span>=<span class="string">$&#123;app.name&#125; is a Spring Boot application</span></span><br></pre></td></tr></table></figure>

<h3 id="4-2-7-使用YAML文件替代properties文件"><a href="#4-2-7-使用YAML文件替代properties文件" class="headerlink" title="4.2.7.  使用YAML文件替代properties文件"></a>4.2.7.  使用YAML文件替代properties文件</h3><p>YAML是JSON的超集。SpringApplication类自动支持YAML，前提是需要有SnakeYAML库在classpath中。如果使用starters的话，SnakeYAML是由spring-boot-starter提供的。</p>
<h4 id="加载YAML"><a href="#加载YAML" class="headerlink" title="加载YAML"></a>加载YAML</h4><p>YamlPropertiesFactoryBean把YAML加载成Properties，YamlMapFactoryBean把YAML加载成Map。</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">environments:</span></span><br><span class="line">    <span class="attr">dev:</span></span><br><span class="line">        <span class="attr">url:</span> <span class="string">https://dev.example.com</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">Developer</span> <span class="string">Setup</span></span><br><span class="line">    <span class="attr">prod:</span></span><br><span class="line">        <span class="attr">url:</span> <span class="string">https://another.example.com</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">My</span> <span class="string">Cool</span> <span class="string">App</span></span><br></pre></td></tr></table></figure>

<p>会被加载成：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">environments.dev.url</span>=<span class="string">https://dev.example.com</span></span><br><span class="line"><span class="meta">environments.dev.name</span>=<span class="string">Developer Setup</span></span><br><span class="line"><span class="meta">environments.prod.url</span>=<span class="string">https://another.example.com</span></span><br><span class="line"><span class="meta">environments.prod.name</span>=<span class="string">My Cool App</span></span><br></pre></td></tr></table></figure>

<p>YAML列表用[index]解引用器表示为属性键。例如，考虑以下YAML：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">my:</span></span><br><span class="line">   <span class="attr">servers:</span></span><br><span class="line">       <span class="bullet">-</span> <span class="string">dev.example.com</span></span><br><span class="line">       <span class="bullet">-</span> <span class="string">another.example.com</span></span><br></pre></td></tr></table></figure>

<p>将会被转换为：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">my.servers[0]</span>=<span class="string">dev.example.com</span></span><br><span class="line"><span class="meta">my.servers[1]</span>=<span class="string">another.example.com</span></span><br></pre></td></tr></table></figure>

<p>要通过使用Spring Boot的Binder实用程序（@ConfigurationProperties所做的）绑定到类似的属性，您需要在类型为java.util.List（或Set）的目标bean中拥有一个属性，或者您需要提供一个setter或使用可变值对其进行初始化。例如，以下示例绑定到前面显示的属性：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix=&quot;my&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Config</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; servers = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;String&gt; <span class="title">getServers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.servers;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>yml文件为application.yml文件。</p>
<h4 id="多profile的YAML文档"><a href="#多profile的YAML文档" class="headerlink" title="多profile的YAML文档"></a>多profile的YAML文档</h4><p>您可以使用spring.profiles键在一个文件中指定多个特定于配置文件的YAML文档，以指示何时应用该文档，如以下示例所示：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">address:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.100</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">profiles:</span> <span class="string">development</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">address:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">    <span class="attr">profiles:</span> <span class="string">production</span> <span class="string">&amp;</span> <span class="string">eu-central</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">    <span class="attr">address:</span> <span class="number">192.168</span><span class="number">.1</span><span class="number">.120</span></span><br></pre></td></tr></table></figure>

<p>如果在启动应用程序上下文时未明确激活任何活动，则会激活默认配置文件。因此，在以下YAML中，我们为spring.security.user.password设置了一个值，该值仅在“默认”配置文件中可用：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8000</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">default</span></span><br><span class="line">  <span class="attr">security:</span></span><br><span class="line">    <span class="attr">user:</span></span><br><span class="line">      <span class="attr">password:</span> <span class="string">weak</span></span><br></pre></td></tr></table></figure>

<h3 id="4-2-8-类型安全的配置属性"><a href="#4-2-8-类型安全的配置属性" class="headerlink" title="4.2.8.  类型安全的配置属性"></a>4.2.8.  类型安全的配置属性</h3><p>使用@Value(“${}”)来进行属性依赖注入有时候会很复杂。Spring Boot提供了一种使用属性的替代方法，该属性使强类型的Bean可以管理和验证应用程序的配置。</p>
<p>这种方法就是把配置文件直接加载到类中去。</p>
<h4 id="JavaBean字段绑定"><a href="#JavaBean字段绑定" class="headerlink" title="JavaBean字段绑定"></a>JavaBean字段绑定</h4><p>定义一个PoJo类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(&quot;man&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Address address;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAddress</span><span class="params">(Address address)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.address = address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Address <span class="title">getAddress</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Address</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> String street;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setStreet</span><span class="params">(String street)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.street = street;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">getStreet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> street;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Address&#123;&quot;</span> +</span><br><span class="line">                    <span class="string">&quot;street=&#x27;&quot;</span> + street + <span class="string">&#x27;\&#x27;&#x27;</span> +</span><br><span class="line">                    <span class="string">&#x27;&#125;&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>可以看出这个类有man.name;man.address.street两个字段。</p>
<p>在application.yml中配置：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">man:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">hsp</span></span><br><span class="line">  <span class="attr">address:</span></span><br><span class="line">    <span class="attr">street:</span> <span class="string">str</span> <span class="string">one</span></span><br></pre></td></tr></table></figure>

<p>控制器中如下设置：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &#123;&quot;com.example.demo&quot;&#125;)</span></span><br><span class="line"><span class="meta">@PropertySource(&quot;/config/spring-user.properties&quot;)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(&#123;Person.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Example</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> Person person;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Person <span class="title">hi</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> person;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication application = <span class="keyword">new</span> SpringApplication(Example.class);</span><br><span class="line">        application.run(args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>@EnableConfigurationProperties({Person.class})是把application.xml中的相关数据注入到Person类中。也可以定义其他配置文件，如@PropertySource(“/config/spring-user.properties”)。</p>
<h4 id="构造器绑定"><a href="#构造器绑定" class="headerlink" title="构造器绑定"></a>构造器绑定</h4><p>在需要注入的类上添加@ConstructorBinding可以实现构造器绑定。</p>
<p>如果可能为空，则可以用@DefaultValue修饰参数，如果参数没有相关注入，则会给它赋值null。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example;</span><br><span class="line"><span class="keyword">import</span> java.net.InetAddress;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConstructorBinding;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.bind.DefaultValue;</span><br><span class="line"></span><br><span class="line"><span class="meta">@ConstructorBinding</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(&quot;acme&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AcmeProperties</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">boolean</span> enabled;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> InetAddress remoteAddress;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Security security;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AcmeProperties</span><span class="params">(<span class="keyword">boolean</span> enabled, InetAddress remoteAddress, <span class="meta">@DefaultValue</span> Security security)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.enabled = enabled;</span><br><span class="line">        <span class="keyword">this</span>.remoteAddress = remoteAddress;</span><br><span class="line">        <span class="keyword">this</span>.security = security;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>要使用构造函数绑定，必须使用@EnableConfigurationProperties或配置属性扫描来启用该类。您不能对通过常规Spring机制创建的bean使用构造函数绑定（例如@Component bean，通过@Bean方法创建的bean或使用@Import加载的bean）</p>
<p>如果您的类具有多个构造函数，则还可以直接在应绑定的构造函数上使用@ConstructorBinding。</p>
<h4 id="第三方配置"><a href="#第三方配置" class="headerlink" title="第三方配置"></a>第三方配置</h4><p>@ConfigurationProperties可以用在bean定义上。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;another&quot;)</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> AnotherComponent <span class="title">anotherComponent</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="宽松绑定"><a href="#宽松绑定" class="headerlink" title="宽松绑定"></a>宽松绑定</h4><p>Spring Boot使用一些宽松的规则将Environment属性绑定到@ConfigurationProperties bean，因此环境属性名称和bean属性名称之间不需要完全匹配。有用的常见示例包括破折号分隔的环境属性（例如，上下文路径绑定到contextPath）和大写的环境属性（例如PORT绑定到端口）。</p>
<table>
<thead>
<tr>
<th align="left">Property</th>
<th align="left">Note</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>acme.my-project.person.first-name</code></td>
<td align="left">Kebab case, which is recommended for use in <code>.properties</code> and <code>.yml</code> files.</td>
</tr>
<tr>
<td align="left"><code>acme.myProject.person.firstName</code></td>
<td align="left">Standard camel case syntax.</td>
</tr>
<tr>
<td align="left"><code>acme.my_project.person.first_name</code></td>
<td align="left">Underscore notation, which is an alternative format for use in <code>.properties</code> and <code>.yml</code> files.</td>
</tr>
<tr>
<td align="left"><code>ACME_MYPROJECT_PERSON_FIRSTNAME</code></td>
<td align="left">Upper case format, which is recommended when using system environment variables.</td>
</tr>
</tbody></table>
<h4 id="绑定Map"><a href="#绑定Map" class="headerlink" title="绑定Map"></a>绑定Map</h4><p>绑定到Map属性时，如果键包含小写字母数字字符或-以外的任何其他字符，则需要使用方括号表示法，以便保留原始值。如果键没有被[]包围，则所有非字母数字或-的字符都将被删除。例如，考虑将以下属性绑定到Map：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">acme:</span><br><span class="line">  map:</span><br><span class="line">    &quot;[&#x2F;key1]&quot;: value1</span><br><span class="line">    &quot;[&#x2F;key2]&quot;: value2</span><br><span class="line">    &#x2F;key3: value3</span><br></pre></td></tr></table></figure>

<p>上面的属性将以/ key1，/ key2和key3作为映射中的键绑定到Map。</p>
<h4 id="从环境变量绑定"><a href="#从环境变量绑定" class="headerlink" title="从环境变量绑定"></a>从环境变量绑定</h4><p>大多数操作系统在可用于环境变量的名称周围施加严格的规则。例如，Linux shell变量只能包含字母（a到z或A到Z），数字（0到9）或下划线字符（_）。按照约定，Unix shell变量也将以大写字母命名。 Spring Boot的宽松绑定规则尽可能地与这些命名限制兼容。</p>
<p>要将规范形式的属性名称转换为环境变量名称，可以遵循以下规则：</p>
<ol>
<li>使用下划线_替代点.</li>
<li>移除-</li>
<li>转换为大写</li>
</ol>
<p>例如，配置属性spring.main.log-startup-info将是一个名为SPRING_MAIN_LOGSTARTUPINFO的环境变量。</p>
<p>绑定到对象列表时也可以使用环境变量。要绑定到列表，元素编号应在变量名称中用下划线括起来。 例如，配置属性my.acme [0] .other将使用名为MY_ACME_0_OTHER的环境变量。</p>
<h4 id="绑定复杂类型"><a href="#绑定复杂类型" class="headerlink" title="绑定复杂类型"></a>绑定复杂类型</h4><p>复杂类型怎么绑定。如list或者map。</p>
<p>新建一个pojo类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyPoJo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String description;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDescription</span><span class="params">(String description)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.description = description;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getDescription</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> description;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在person类中如下定义：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(&quot;man&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;MyPoJo&gt; list;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setList</span><span class="params">(List&lt;MyPoJo&gt; list)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.list = list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;MyPoJo&gt; <span class="title">getList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, MyPoJo&gt; map;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMap</span><span class="params">(Map&lt;String, MyPoJo&gt; map)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.map = map;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, MyPoJo&gt; <span class="title">getMap</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在controller中设置：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &#123;&quot;com.example.demo&quot;&#125;)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(&#123;Person.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Example</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> Person person;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Person <span class="title">hi</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> person;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(Example.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在根目录网页中就可以获得绑定好的person对象。</p>
<p>在application.yml中配置：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">man:</span></span><br><span class="line">  <span class="attr">list:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">list</span> <span class="string">one</span> <span class="string">name</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">this</span> <span class="string">is</span> <span class="string">obj1</span> <span class="string">of</span> <span class="string">list</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">list</span> <span class="string">two</span> <span class="string">name</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">this</span> <span class="string">is</span> <span class="string">obj2</span> <span class="string">of</span> <span class="string">list</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">map:</span></span><br><span class="line">    <span class="attr">key1:</span></span><br><span class="line">      <span class="attr">name:</span> <span class="string">map</span> <span class="string">one</span> <span class="string">name</span></span><br><span class="line">      <span class="attr">description:</span> <span class="string">this</span> <span class="string">is</span> <span class="string">obj1</span> <span class="string">of</span> <span class="string">map</span></span><br></pre></td></tr></table></figure>

<h4 id="属性转换"><a href="#属性转换" class="headerlink" title="属性转换"></a>属性转换</h4><p>当Spring Boot绑定到@ConfigurationProperties bean时，它尝试将外部应用程序属性强制为正确的类型。如果需要自定义类型转换，则可以提供一个ConversionService bean（具有一个名为conversionService的bean）或自定义属性编辑器（通过CustomEditorConfigurer bean）或自定义Converters（具有定义为@ConfigurationPropertiesBinding的bean定义）。</p>
<h4 id="转换duration"><a href="#转换duration" class="headerlink" title="转换duration"></a>转换duration</h4><p>Spring Boot为表达持续时间提供了专门的支持。如果公开java.time.Duration属性，则应用程序属性中的以下格式可用：</p>
<ol>
<li>long形数可以使用@DurationUnit设置单位，默认是毫秒</li>
<li>ISO-8601格式</li>
<li>便于阅读的格式比如10s</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(&quot;app.system&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AppSystemProperties</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DurationUnit(ChronoUnit.SECONDS)</span></span><br><span class="line">    <span class="keyword">private</span> Duration sessionTimeout = Duration.ofSeconds(<span class="number">30</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Duration readTimeout = Duration.ofMillis(<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Duration <span class="title">getSessionTimeout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.sessionTimeout;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSessionTimeout</span><span class="params">(Duration sessionTimeout)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.sessionTimeout = sessionTimeout;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Duration <span class="title">getReadTimeout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.readTimeout;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setReadTimeout</span><span class="params">(Duration readTimeout)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.readTimeout = readTimeout;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>要指定30秒的会话超时，则30，PT30S和30s都是等效的。可以使用以下任意形式指定500ms的读取超时：500，PT0.5S和500ms。 您也可以使用任何受支持的单位。这些是： ns纳秒 us微秒 毫秒（毫秒） s秒 m分钟 h小时 d天 默认单位是毫秒，可以使用@DurationUnit覆盖，如上面的示例所示。</p>
<h4 id="转换DataSize对象"><a href="#转换DataSize对象" class="headerlink" title="转换DataSize对象"></a>转换DataSize对象</h4><ul>
<li>long数默认byte，可以使用@DataSizeUnit定义单位</li>
<li>10MB也可以用</li>
</ul>
<p>如果把大小转换给long数的话，需要定义@DataSizeUnit注解</p>
<h4 id="ConfigurationProperties注解验证"><a href="#ConfigurationProperties注解验证" class="headerlink" title="@ConfigurationProperties注解验证"></a>@ConfigurationProperties注解验证</h4><p>每当使用Spring的@Validated注释对@ConfigurationProperties类进行注释时，Spring Boot就会尝试对其进行验证。您可以在配置类上直接使用JSR-303 javax.validation约束注释。为此，请确保在类路径上有兼容的JSR-303实现，然后将约束注释添加到字段中，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix=&quot;acme&quot;)</span></span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AcmeProperties</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="keyword">private</span> InetAddress remoteAddress;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ... getters and setters</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>您还可以通过使用@Validated注释创建配置属性的@Bean方法来触发验证。</p>
<p>为了确保始终为嵌套属性触发验证，即使未找到任何属性，也必须使用@Valid注释关联的字段。下面的示例基于前面的AcmeProperties示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix=&quot;acme&quot;)</span></span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AcmeProperties</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotNull</span></span><br><span class="line">    <span class="keyword">private</span> InetAddress remoteAddress;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Valid</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Security security = <span class="keyword">new</span> Security();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ... getters and setters</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Security</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@NotEmpty</span></span><br><span class="line">        <span class="keyword">public</span> String username;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ... getters and setters</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="ConfigurationProperties和-Value比较"><a href="#ConfigurationProperties和-Value比较" class="headerlink" title="@ConfigurationProperties和@Value比较"></a>@ConfigurationProperties和@Value比较</h4><table>
<thead>
<tr>
<th align="left">Feature</th>
<th align="left"><code>@ConfigurationProperties</code></th>
<th align="left"><code>@Value</code></th>
</tr>
</thead>
<tbody><tr>
<td align="left">宽松绑定</td>
<td align="left">Yes</td>
<td align="left">Limited (see note below)</td>
</tr>
<tr>
<td align="left">元数据支持</td>
<td align="left">Yes</td>
<td align="left">No</td>
</tr>
<tr>
<td align="left"><code>SpEL</code> evaluation</td>
<td align="left">No</td>
<td align="left">Yes</td>
</tr>
</tbody></table>
<p>如果您为自己的组件定义了一组配置键，我们建议您将它们组合在以@ConfigurationProperties注释的POJO中。这样做将为您提供结构化的，类型安全的对象，您可以将其注入到自己的bean中。 </p>
<p>如果确实要使用@Value，我们建议您使用规范形式引用属性名称（kebab-case仅使用小写字母）。这将允许Spring Boot使用与轻松绑定@ConfigurationProperties时相同的逻辑。例如，@Value（“ {demo.item-price}”）将从application.properties文件中选取demo.item-price和demo.itemPrice表格，并从系统环境中选取DEMO_ITEMPRICE。如果改用@Value（“ {demo.itemPrice}”），则将不考虑demo.item-price和DEMO_ITEMPRICE。 </p>
<p>最后，尽管您可以在@Value中编写SpEL表达式，但不会从应用程序属性文件中处理此类表达式。</p>
<h2 id="4-3-Profiles"><a href="#4-3-Profiles" class="headerlink" title="4.3.  Profiles"></a>4.3.  Profiles</h2><p>Spring Profiles提供了一种隔离应用程序配置部分并使之仅在某些环境中可用的方法。任何@ Component，@ Configuration或@ConfigurationProperties都可以用@Profile标记，如以下示例所示：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="meta">@Profile(&quot;production&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductionConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果@ConfigurationProperties Bean是通过@EnableConfigurationProperties而非自动扫描注册的，则需要在具有@EnableConfigurationProperties批注的@Configuration类上指定@Profile批注。在扫描@ConfigurationProperties的情况下，可以在@ConfigurationProperties类本身上指定@Profile。</p>
<p>您可以使用spring.profiles.active环境属性来指定哪些配置文件处于活动状态。您可以通过本章前面介绍的任何方式指定属性。例如，您可以将其包含在application.properties中，如以下示例所示：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.profiles.active</span>=<span class="string">dev,hsqldb</span></span><br></pre></td></tr></table></figure>

<p>您也可以使用以下开关在命令行上指定它：–spring.profiles.active = dev，hsqldb。</p>
<h4 id="在不同环境下使用配置"><a href="#在不同环境下使用配置" class="headerlink" title="在不同环境下使用配置"></a>在不同环境下使用配置</h4><p>新建/config/application-dev.yml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">time:</span></span><br><span class="line">  <span class="attr">msg:</span> <span class="string">dev</span></span><br></pre></td></tr></table></figure>

<p>新建/config/application-test.yml</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">time:</span></span><br><span class="line">  <span class="attr">msg:</span> <span class="string">test</span></span><br></pre></td></tr></table></figure>

<p>在application.yml中配置</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">dev</span></span><br></pre></td></tr></table></figure>

<p>或者在controller中加@Profile注解：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@ComponentScan(basePackages = &#123;&quot;com.example.demo&quot;&#125;)</span></span><br><span class="line"><span class="meta">@Profile(&quot;dev&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Example</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(msg);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(Example.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>输出dev。</p>
<h2 id="4-4-Logging"><a href="#4-4-Logging" class="headerlink" title="4.4.  Logging"></a>4.4.  Logging</h2><p>Spring Boot使用Commons Logging进行所有内部日志记录，但是使底层日志实现保持打开状态。提供了Java Util Logging，Log4J2和Logback的默认配置。在每种情况下，记录器都已预先配置为使用控制台输出，同时还提供可选文件输出。</p>
<p>如果使用的是starter模块，默认使用Logback。</p>
<h3 id="4-4-1-日志格式"><a href="#4-4-1-日志格式" class="headerlink" title="4.4.1.  日志格式"></a>4.4.1.  日志格式</h3><p>输入如下内容：</p>
<ul>
<li>日期和事件：精确到毫秒</li>
<li>log登记：ERROR、WARN、INFO、DEBUG或TRACE</li>
<li>进程id</li>
<li>—分隔符</li>
<li>进程名</li>
<li>logger名，一般缩写</li>
<li>log信息</li>
</ul>
<h3 id="4-4-2-控制台输出"><a href="#4-4-2-控制台输出" class="headerlink" title="4.4.2.  控制台输出"></a>4.4.2.  控制台输出</h3><p>如何控制输出的内容，在命令行参数中加入–debug：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ java -jar myapp.jar --debug</span><br></pre></td></tr></table></figure>

<p>或者在application.properties中加入debug=true。</p>
<h3 id="4-4-3-额外输出到文件"><a href="#4-4-3-额外输出到文件" class="headerlink" title="4.4.3.   额外输出到文件"></a>4.4.3.   额外输出到文件</h3><p>使用logging.file.name或logging.file.path来设置文件信息。</p>
<p>日志文件达到10 MB时会旋转，并且与控制台输出一样，默认情况下会记录ERROR级别，WARN级别和INFO级别的消息。可以使用logging.file.max-size属性更改大小限制。除非已设置logging.file.max-history属性，否则默认情况下将保留最近7天的轮转日志文件。可以使用logging.file.total-size-cap限制日志归档文件的总大小。当日志归档的总大小超过该阈值时，将删除备份。要在应用程序启动时强制清除日志归档文件，请使用logging.file.clean-history-on-start属性。</p>
<h3 id="4-4-4-日志等级"><a href="#4-4-4-日志等级" class="headerlink" title="4.4.4.  日志等级"></a>4.4.4.  日志等级</h3><p>通过使用logging.level，可以在Spring环境中（例如，在application.properties中）设置所有受支持的日志记录器级别。<logger-name> = <level>，其中level是TRACE，DEBUG，INFO，警告，错误，致命或关闭。可以使用logging.level.root配置根记录器。 以下示例显示了application.properties中的潜在日志记录设置：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">logging.level.root</span>=<span class="string">warn</span></span><br><span class="line"><span class="meta">logging.level.org.springframework.web</span>=<span class="string">debug</span></span><br><span class="line"><span class="meta">logging.level.org.hibernate</span>=<span class="string">error</span></span><br></pre></td></tr></table></figure>

<p>也可以使用环境变量设置日志记录级别。例如，LOGGING_LEVEL_ORG_SPRINGFRAMEWORK_WEB = DEBUG会将org.springframework.web设置为DEBUG。</p>
<h3 id="其他日志相关"><a href="#其他日志相关" class="headerlink" title="其他日志相关"></a>其他日志相关</h3><p>不再赘述，看文档</p>
<h2 id="4-5-国际化"><a href="#4-5-国际化" class="headerlink" title="4.5.  国际化"></a>4.5.  国际化</h2><h2 id="4-6-JSON"><a href="#4-6-JSON" class="headerlink" title="4.6.   JSON"></a>4.6.   JSON</h2><p>提供如下json库。</p>
<ul>
<li>Gson</li>
<li>Jackson</li>
<li>JSON-B</li>
</ul>
<h2 id="4-7-web应用"><a href="#4-7-web应用" class="headerlink" title="4.7.  web应用"></a>4.7.  web应用</h2><h3 id="4-7-1-Spring-MVC框架"><a href="#4-7-1-Spring-MVC框架" class="headerlink" title="4.7.1.  Spring MVC框架"></a>4.7.1.  Spring MVC框架</h3></div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">crazyStrome</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://crazystrome.github.io/2020/11/06/SpringBoot/">http://crazystrome.github.io/2020/11/06/SpringBoot/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://crazyStrome.github.io" target="_blank">crazyStrome的博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Java/">Java</a><a class="post-meta__tags" href="/tags/%E7%AC%94%E8%AE%B0/">笔记</a><a class="post-meta__tags" href="/tags/Spring/">Spring</a></div><div class="post_share"><div class="social-share" data-image="https://dzone.com/storage/temp/12434118-spring-boot-logo.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2020/11/06/SpringMVC%E8%BF%9E%E6%8E%A5%E6%95%B0%E6%8D%AE%E5%BA%93/"><img class="prev-cover" src="https://dzone.com/storage/temp/12434118-spring-boot-logo.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">SpringMVC连接数据库</div></div></a></div><div class="next-post pull-right"><a href="/2020/11/06/spring/"><img class="next-cover" src="https://dzone.com/storage/temp/12434118-spring-boot-logo.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Spring官方文档笔记</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2020/11/06/spring总结/" title="Spring总结"><img class="cover" src="https://dzone.com/storage/temp/12434118-spring-boot-logo.png"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-11-06</div><div class="title">Spring总结</div></div></a></div><div><a href="/2020/11/06/SpringMVC连接数据库/" title="SpringMVC连接数据库"><img class="cover" src="https://dzone.com/storage/temp/12434118-spring-boot-logo.png"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-11-06</div><div class="title">SpringMVC连接数据库</div></div></a></div><div><a href="/2020/11/06/spring/" title="Spring官方文档笔记"><img class="cover" src="https://dzone.com/storage/temp/12434118-spring-boot-logo.png"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-11-06</div><div class="title">Spring官方文档笔记</div></div></a></div><div><a href="/2020/11/04/OnJava8笔记/" title="OnJava8笔记"><img class="cover" src="https://visiontrainingsystems.com/wp-content/uploads/2016/05/java-690x388.png"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-11-04</div><div class="title">OnJava8笔记</div></div></a></div><div><a href="/2020/11/04/HashMap相关/" title="HashMap相关"><img class="cover" src="https://visiontrainingsystems.com/wp-content/uploads/2016/05/java-690x388.png"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-11-04</div><div class="title">HashMap相关</div></div></a></div><div><a href="/2020/11/04/JVM的内存分区/" title="JVM内存分区"><img class="cover" src="https://i.loli.net/2020/03/22/HIx6ugVmdNTRMwE.png"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2020-11-04</div><div class="title">JVM内存分区</div></div></a></div></div></div></article></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 By crazyStrome</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="chat_btn" type="button" title="rightside.chat_btn"><i class="fas fa-sms"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></section><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><div class="js-pjax"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></div></body></html>